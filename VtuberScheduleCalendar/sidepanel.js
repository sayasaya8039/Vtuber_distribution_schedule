import{r as u,u as k,j as e,s as M,g as S,a as _,b as G,d as K,c as F}from"./assets/store.js";function B(n){const a=n.trim();if(a.startsWith("UC")&&a.length>=24)return a.split(/[^a-zA-Z0-9_-]/)[0];const t=a.match(/youtube\.com\/channel\/(UC[a-zA-Z0-9_-]+)/);return t?t[1]:null}function H(){const[n,a]=u.useState(""),[t,l]=u.useState([]),[i,o]=u.useState(!1),{holodexApiKey:m,addVTuber:g,vtubers:p}=k(),b=async()=>{var y,E,f,C;if(!n.trim()||!m)return;const c=B(n);o(!0);try{if(c){const N=await fetch(`https://holodex.net/api/v2/channels/${c}`,{headers:{"X-APIKEY":m}});if(N.ok){const x=await N.json(),w={id:x.id,name:x.english_name||x.name,channelId:x.id,org:(y=x.org)!=null&&y.toLowerCase().includes("hololive")?"hololive":(E=x.org)!=null&&E.toLowerCase().includes("nijisanji")?"nijisanji":"indie",color:(f=x.org)!=null&&f.toLowerCase().includes("hololive")?"#00bfff":(C=x.org)!=null&&C.toLowerCase().includes("nijisanji")?"#ff6b6b":"#a855f7",avatarUrl:x.photo};l([w])}else l([])}else{const N=await M(m,n);l(N)}}catch(N){console.error("Search failed:",N),l([])}finally{o(!1)}},v=async c=>{await g(c),l(t.filter(y=>y.channelId!==c.channelId))},d=c=>p.some(y=>y.channelId===c);return e.jsxs("div",{className:"vtuber-search",children:[e.jsxs("div",{className:"search-input",children:[e.jsx("input",{type:"text",value:n,onChange:c=>a(c.target.value),onKeyDown:c=>c.key==="Enter"&&b(),placeholder:"VTuberå or YouTube URLè²¼ã£ã¦ã­!",disabled:!m}),e.jsx("button",{onClick:b,disabled:i||!m,children:i?"æ¤œç´¢ä¸­...":"è¿½åŠ ã™ã‚‹"})]}),!m&&e.jsx("p",{className:"warning",children:"è¨­å®šã‹ã‚‰Holodex APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ã­"}),e.jsx("p",{className:"help-text-small",children:"VTuberåã§æ¤œç´¢ã€ã¾ãŸã¯YouTube URLã‚„ãƒãƒ£ãƒ³ãƒãƒ«ID(UCã§å§‹ã¾ã‚‹)ã‚’ç›´æ¥å…¥åŠ›"}),t.length>0&&e.jsx("div",{className:"search-results",children:t.map(c=>e.jsxs("div",{className:"search-result-item",children:[e.jsx("img",{src:c.avatarUrl||"/icons/icon48.png",alt:c.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:c.name}),e.jsx("span",{className:"org",style:{color:c.color},children:c.org||"indie"})]}),e.jsx("button",{onClick:()=>v(c),disabled:d(c.channelId),children:d(c.channelId)?"è¿½åŠ æ¸ˆã¿":"è¿½åŠ "})]},c.channelId))})]})}function Y(){const{vtubers:n,removeVTuber:a}=k();return n.length===0?e.jsxs("div",{className:"vtuber-list empty",children:[e.jsx("p",{children:"ğŸ­ ã¾ã VTuberãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{children:"ä¸Šã®æ¤œç´¢ã‹ã‚‰æ¨ã—ã‚’è¿½åŠ ã—ã‚ˆã†ï¼"})]}):e.jsxs("div",{className:"vtuber-list",children:[e.jsxs("h3",{children:["ç™»éŒ²æ¸ˆã¿VTuber (",n.length,")"]}),n.map(t=>e.jsxs("div",{className:"vtuber-item",children:[e.jsx("img",{src:t.avatarUrl||"/icons/icon48.png",alt:t.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"org-badge",style:{backgroundColor:t.color},children:t.org||"indie"})]}),e.jsx("button",{className:"remove-btn",onClick:()=>a(t.channelId),title:"å‰Šé™¤",children:"âœ•"})]},t.channelId))]})}const z="https://www.googleapis.com/calendar/v3";async function D(n=!0){return new Promise((a,t)=>{chrome.identity.getAuthToken({interactive:n},l=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):l?a(l):t(new Error("Failed to get auth token"))})})}async function Z(){const n=await D(!1).catch(()=>null);n&&await new Promise(a=>{chrome.identity.removeCachedAuthToken({token:n},a)})}async function J(n,a="primary"){var i;const t=await D(),l=await fetch(`${z}/calendars/${a}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok){const o=await l.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create event")}return l.json()}function q(n,a,t=30){const l=S(n),i=_(n),o=`https://www.youtube.com/watch?v=${n.id}`;return{summary:`ğŸ­ ${a.name} é…ä¿¡: ${n.title}`,description:`é…ä¿¡URL: ${o}

ãƒãƒ£ãƒ³ãƒãƒ«: ${n.channel.name}`,start:{dateTime:l.toISOString(),timeZone:"Asia/Tokyo"},end:{dateTime:i.toISOString(),timeZone:"Asia/Tokyo"},colorId:Q(a.org),reminders:{useDefault:!1,overrides:[{method:"popup",minutes:t}]}}}function Q(n){switch(n){case"hololive":return"9";case"nijisanji":return"11";case"indie":return"3";default:return"8"}}function V(n){return`vtuber_${n.id}_${n.start_scheduled||n.available_at}`}function W(n,a){const t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//VTuber Schedule Calendar//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];for(const l of n){const i=a.find(p=>p.channelId===l.channel.id),o=S(l),m=new Date(o.getTime()+7200*1e3),g=p=>p.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");t.push("BEGIN:VEVENT"),t.push(`UID:${l.id}@vtuber-schedule`),t.push(`DTSTART:${g(o)}`),t.push(`DTEND:${g(m)}`),t.push(`SUMMARY:${(i==null?void 0:i.name)||l.channel.name} - ${l.title}`),t.push(`DESCRIPTION:https://www.youtube.com/watch?v=${l.id}`),t.push(`URL:https://www.youtube.com/watch?v=${l.id}`),t.push("END:VEVENT")}return t.push("END:VCALENDAR"),t.join(`\r
`)}function X(){const{schedules:n,vtubers:a,loading:t,settings:l}=k(),[i,o]=u.useState(null),[m,g]=u.useState(!1),[p,b]=u.useState([]),[v,d]=u.useState("all"),[c,y]=u.useState("all");u.useEffect(()=>{G().then(s=>b(s.syncedEventIds))},[]);const f=[...n.filter(s=>{const r=S(s),h=new Date,j=new Date(h.getFullYear(),h.getMonth(),h.getDate()),I=new Date(j.getTime()+1440*60*1e3),U=new Date(j.getTime()+10080*60*1e3);let A=!0;if(v==="today")A=r>=j&&r<I;else if(v==="tomorrow"){const T=new Date(I.getTime()+864e5);A=r>=I&&r<T}else v==="week"&&(A=r>=j&&r<U);let R=!0;if(c!=="all"){const T=a.find(P=>P.channelId===s.channel.id);R=(T==null?void 0:T.org)===c}return A&&R})].sort((s,r)=>S(s).getTime()-S(r).getTime()),C=async s=>{const r=a.find(h=>h.channelId===s.channel.id);if(r){o(s.id);try{const h=q(s,r,l.reminderMinutes);await J(h,l.calendarId);const j=V(s);await K(j),b(I=>[...I,j])}catch(h){console.error("Failed to add to calendar:",h),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{o(null)}}},N=async()=>{const s=f.filter(r=>!w(r));if(s.length!==0){g(!0);try{for(const r of s)await C(r);alert(`${s.length}ä»¶ã®é…ä¿¡ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ ã—ã¾ã—ãŸ!`)}finally{g(!1)}}},x=()=>{const s=W(f,a),r=new Blob([s],{type:"text/calendar;charset=utf-8"}),h=URL.createObjectURL(r),j=document.createElement("a");j.href=h,j.download=`vtuber-schedule-${new Date().toISOString().split("T")[0]}.ics`,j.click(),URL.revokeObjectURL(h)},w=s=>p.includes(V(s)),$=s=>s.toLocaleString("ja-JP",{month:"numeric",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),O=s=>{const r=a.find(h=>h.channelId===s);return(r==null?void 0:r.color)||"#666"};if(t)return e.jsx("div",{className:"schedule-list loading",children:"èª­ã¿è¾¼ã¿ä¸­..."});if(n.length===0)return e.jsxs("div",{className:"schedule-list empty",children:[e.jsx("p",{children:"é…ä¿¡äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“"}),a.length===0&&e.jsx("p",{children:"VTuberã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]});const L=f.filter(s=>!w(s)).length;return e.jsxs("div",{className:"schedule-list",children:[e.jsx("div",{className:"filter-section",children:e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:v,onChange:s=>d(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨æœŸé–“"}),e.jsx("option",{value:"today",children:"ä»Šæ—¥"}),e.jsx("option",{value:"tomorrow",children:"æ˜æ—¥"}),e.jsx("option",{value:"week",children:"ä»Šé€±"})]}),e.jsxs("select",{value:c,onChange:s=>y(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨ã‚°ãƒ«ãƒ¼ãƒ—"}),e.jsx("option",{value:"hololive",children:"hololive"}),e.jsx("option",{value:"nijisanji",children:"ã«ã˜ã•ã‚“ã˜"}),e.jsx("option",{value:"indie",children:"ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼"})]})]})}),e.jsxs("div",{className:"schedule-header",children:[e.jsxs("h3",{children:["é…ä¿¡äºˆå®š (",f.length,"ä»¶)"]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"export-btn",onClick:x,title:"Outlook/Apple Calendarç”¨",children:".ics"}),L>0&&e.jsx("button",{className:"sync-all-btn",onClick:N,disabled:m,children:m?"è¿½åŠ ä¸­...":`å…¨ã¦è¿½åŠ  (${L})`})]})]}),f.length===0?e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"è©²å½“ã™ã‚‹é…ä¿¡ãŒã‚ã‚Šã¾ã›ã‚“"})}):f.map(s=>e.jsxs("div",{className:"schedule-item",style:{borderLeftColor:O(s.channel.id)},children:[e.jsx("div",{className:"schedule-time",children:s.status==="live"?e.jsx("span",{className:"live-badge",children:"LIVE"}):$(S(s))}),e.jsxs("div",{className:"schedule-info",children:[e.jsx("span",{className:"channel-name",children:s.channel.name}),e.jsx("span",{className:"title",children:s.title})]}),e.jsxs("div",{className:"schedule-actions",children:[e.jsx("a",{href:`https://www.youtube.com/watch?v=${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"youtube-link",title:"YouTubeã§é–‹ã",children:"â–¶"}),e.jsx("button",{onClick:()=>C(s),disabled:i===s.id||w(s),title:w(s)?"è¿½åŠ æ¸ˆã¿":"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ ",children:i===s.id?"...":w(s)?"v":"+"})]})]},s.id))]})}function ee(){const{holodexApiKey:n,settings:a,setApiKey:t,updateSettings:l}=k(),[i,o]=u.useState(n),[m,g]=u.useState(!1),p=async()=>{await t(i),alert("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ")},b=async()=>{try{await D(!0),g(!0),alert("Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ¥ç¶šã—ã¾ã—ãŸ")}catch(d){alert("æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ: "+d.message)}},v=async()=>{await Z(),g(!1),alert("æ¥ç¶šã‚’è§£é™¤ã—ã¾ã—ãŸ")};return e.jsxs("div",{className:"settings",children:[e.jsx("h3",{children:"âš™ï¸ è¨­å®š"}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"Holodex API"}),e.jsxs("p",{className:"help-text",children:[e.jsx("a",{href:"https://holodex.net/login",target:"_blank",rel:"noopener noreferrer",children:"Holodex"}),"ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"password",value:i,onChange:d=>o(d.target.value),placeholder:"Holodex APIã‚­ãƒ¼"}),e.jsx("button",{onClick:p,children:"ä¿å­˜"})]})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"}),m?e.jsxs("div",{className:"connected",children:[e.jsx("span",{children:"âœ… æ¥ç¶šæ¸ˆã¿"}),e.jsx("button",{onClick:v,className:"disconnect-btn",children:"æ¥ç¶šè§£é™¤"})]}):e.jsx("button",{onClick:b,className:"connect-btn",children:"ğŸ”— Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ¥ç¶š"})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"åŒæœŸè¨­å®š"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.autoSync,onChange:d=>l({autoSync:d.target.checked})}),"è‡ªå‹•åŒæœŸã‚’æœ‰åŠ¹ã«ã™ã‚‹"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.notifyOnNewStream,onChange:d=>l({notifyOnNewStream:d.target.checked})}),"æ–°ã—ã„é…ä¿¡äºˆå®šã‚’é€šçŸ¥"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"åŒæœŸé–“éš”ï¼ˆåˆ†ï¼‰"}),e.jsx("input",{type:"number",min:"15",max:"360",value:a.syncIntervalMinutes,onChange:d=>l({syncIntervalMinutes:Number(d.target.value)})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆåˆ†å‰ï¼‰"}),e.jsx("input",{type:"number",min:"5",max:"120",value:a.reminderMinutes,onChange:d=>l({reminderMinutes:Number(d.target.value)})})]})]})]})}function ne(){const[n,a]=u.useState("schedule"),{initialize:t,refreshSchedules:l,error:i}=k();u.useEffect(()=>{t()},[t]);const o=()=>{l()};return e.jsxs("div",{className:"side-panel",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"ğŸ­ VTuber Schedule"}),e.jsx("button",{onClick:o,className:"refresh-btn",title:"æ›´æ–°",children:"ğŸ”„"})]}),i&&e.jsxs("div",{className:"error-banner",children:["âš ï¸ ",i]}),e.jsxs("nav",{className:"tab-nav",children:[e.jsx("button",{className:n==="schedule"?"active":"",onClick:()=>a("schedule"),children:"ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"}),e.jsx("button",{className:n==="vtubers"?"active":"",onClick:()=>a("vtubers"),children:"ğŸ­ VTuber"}),e.jsx("button",{className:n==="settings"?"active":"",onClick:()=>a("settings"),children:"âš™ï¸ è¨­å®š"})]}),e.jsxs("main",{className:"main-content",children:[n==="schedule"&&e.jsx(X,{}),n==="vtubers"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(Y,{})]}),n==="settings"&&e.jsx(ee,{})]}),e.jsx("footer",{className:"footer",children:e.jsx("span",{children:"VTuber Schedule Calendar v1.2.0"})})]})}F.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(ne,{})}));
