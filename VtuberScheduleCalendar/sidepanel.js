import{r as j,u as f,j as e,s as C,g as v,c as T}from"./assets/store.js";function A(t){const l=t.trim();if(l.startsWith("UC")&&l.length>=24)return l.split(/[^a-zA-Z0-9_-]/)[0];const n=l.match(/youtube\.com\/channel\/(UC[a-zA-Z0-9_-]+)/);return n?n[1]:null}function E(){const[t,l]=j.useState(""),[n,a]=j.useState([]),[i,o]=j.useState(!1),{holodexApiKey:d,addVTuber:h,vtubers:u}=f(),b=async()=>{var c,m,x,g;if(!t.trim()||!d)return;const s=A(t);o(!0);try{if(s){const p=await fetch(`https://holodex.net/api/v2/channels/${s}`,{headers:{"X-APIKEY":d}});if(p.ok){const r=await p.json(),y={id:r.id,name:r.english_name||r.name,channelId:r.id,org:(c=r.org)!=null&&c.toLowerCase().includes("hololive")?"hololive":(m=r.org)!=null&&m.toLowerCase().includes("nijisanji")?"nijisanji":"indie",color:(x=r.org)!=null&&x.toLowerCase().includes("hololive")?"#00bfff":(g=r.org)!=null&&g.toLowerCase().includes("nijisanji")?"#ff6b6b":"#a855f7",avatarUrl:r.photo};a([y])}else a([])}else{const p=await C(d,t);a(p)}}catch(p){console.error("Search failed:",p),a([])}finally{o(!1)}},S=async s=>{await h(s),a(n.filter(c=>c.channelId!==s.channelId))},w=s=>u.some(c=>c.channelId===s);return e.jsxs("div",{className:"vtuber-search",children:[e.jsxs("div",{className:"search-input",children:[e.jsx("input",{type:"text",value:t,onChange:s=>l(s.target.value),onKeyDown:s=>s.key==="Enter"&&b(),placeholder:"VTuberå or YouTube URLè²¼ã£ã¦ã­!",disabled:!d}),e.jsx("button",{onClick:b,disabled:i||!d,children:i?"æ¤œç´¢ä¸­...":"è¿½åŠ ã™ã‚‹"})]}),!d&&e.jsx("p",{className:"warning",children:"è¨­å®šã‹ã‚‰Holodex APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ã­"}),e.jsx("p",{className:"help-text-small",children:"VTuberåã§æ¤œç´¢ã€ã¾ãŸã¯YouTube URLã‚„ãƒãƒ£ãƒ³ãƒãƒ«ID(UCã§å§‹ã¾ã‚‹)ã‚’ç›´æ¥å…¥åŠ›"}),n.length>0&&e.jsx("div",{className:"search-results",children:n.map(s=>e.jsxs("div",{className:"search-result-item",children:[e.jsx("img",{src:s.avatarUrl||"/icons/icon48.png",alt:s.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:s.name}),e.jsx("span",{className:"org",style:{color:s.color},children:s.org||"indie"})]}),e.jsx("button",{onClick:()=>S(s),disabled:w(s.channelId),children:w(s.channelId)?"è¿½åŠ æ¸ˆã¿":"è¿½åŠ "})]},s.channelId))})]})}function k(){const{vtubers:t,removeVTuber:l}=f();return t.length===0?e.jsxs("div",{className:"vtuber-list empty",children:[e.jsx("p",{children:"ğŸ­ ã¾ã VTuberãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{children:"ä¸Šã®æ¤œç´¢ã‹ã‚‰æ¨ã—ã‚’è¿½åŠ ã—ã‚ˆã†ï¼"})]}):e.jsxs("div",{className:"vtuber-list",children:[e.jsxs("h3",{children:["ç™»éŒ²æ¸ˆã¿VTuber (",t.length,")"]}),t.map(n=>e.jsxs("div",{className:"vtuber-item",children:[e.jsx("img",{src:n.avatarUrl||"/icons/icon48.png",alt:n.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:n.name}),e.jsx("span",{className:"org-badge",style:{backgroundColor:n.color},children:n.org||"indie"})]}),e.jsx("button",{className:"remove-btn",onClick:()=>l(n.channelId),title:"å‰Šé™¤",children:"âœ•"})]},n.channelId))]})}function D(t,l){const n=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//VTuber Schedule Calendar//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];for(const a of t){const i=l.find(u=>u.channelId===a.channel.id),o=v(a),d=new Date(o.getTime()+7200*1e3),h=u=>u.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");n.push("BEGIN:VEVENT"),n.push(`UID:${a.id}@vtuber-schedule`),n.push(`DTSTART:${h(o)}`),n.push(`DTEND:${h(d)}`),n.push(`SUMMARY:${(i==null?void 0:i.name)||a.channel.name} - ${a.title}`),n.push(`DESCRIPTION:https://www.youtube.com/watch?v=${a.id}`),n.push(`URL:https://www.youtube.com/watch?v=${a.id}`),n.push("END:VEVENT")}return n.push("END:VCALENDAR"),n.join(`\r
`)}function V(){const{schedules:t,vtubers:l,loading:n}=f(),[a,i]=j.useState("all"),[o,d]=j.useState("all"),u=[...t.filter(s=>{const c=v(s),m=new Date,x=new Date(m.getFullYear(),m.getMonth(),m.getDate()),g=new Date(x.getTime()+1440*60*1e3),p=new Date(x.getTime()+10080*60*1e3);let r=!0;if(a==="today")r=c>=x&&c<g;else if(a==="tomorrow"){const N=new Date(g.getTime()+864e5);r=c>=g&&c<N}else a==="week"&&(r=c>=x&&c<p);let y=!0;if(o!=="all"){const N=l.find(I=>I.channelId===s.channel.id);y=(N==null?void 0:N.org)===o}return r&&y})].sort((s,c)=>v(s).getTime()-v(c).getTime()),b=()=>{const s=D(u,l),c=new Blob([s],{type:"text/calendar;charset=utf-8"}),m=URL.createObjectURL(c),x=document.createElement("a");x.href=m,x.download=`vtuber-schedule-${new Date().toISOString().split("T")[0]}.ics`,x.click(),URL.revokeObjectURL(m)},S=s=>s.toLocaleString("ja-JP",{month:"numeric",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),w=s=>{const c=l.find(m=>m.channelId===s);return(c==null?void 0:c.color)||"#666"};return n?e.jsx("div",{className:"schedule-list loading",children:"èª­ã¿è¾¼ã¿ä¸­..."}):t.length===0?e.jsxs("div",{className:"schedule-list empty",children:[e.jsx("p",{children:"é…ä¿¡äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“"}),l.length===0&&e.jsx("p",{children:"VTuberã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]}):e.jsxs("div",{className:"schedule-list",children:[e.jsx("div",{className:"filter-section",children:e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:a,onChange:s=>i(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨æœŸé–“"}),e.jsx("option",{value:"today",children:"ä»Šæ—¥"}),e.jsx("option",{value:"tomorrow",children:"æ˜æ—¥"}),e.jsx("option",{value:"week",children:"ä»Šé€±"})]}),e.jsxs("select",{value:o,onChange:s=>d(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨ã‚°ãƒ«ãƒ¼ãƒ—"}),e.jsx("option",{value:"hololive",children:"hololive"}),e.jsx("option",{value:"nijisanji",children:"ã«ã˜ã•ã‚“ã˜"}),e.jsx("option",{value:"indie",children:"ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼"})]})]})}),e.jsxs("div",{className:"schedule-header",children:[e.jsxs("h3",{children:["é…ä¿¡äºˆå®š (",u.length,"ä»¶)"]}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"export-btn",onClick:b,title:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ",disabled:u.length===0,children:"ğŸ“… .ics"})})]}),u.length===0?e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"è©²å½“ã™ã‚‹é…ä¿¡ãŒã‚ã‚Šã¾ã›ã‚“"})}):u.map(s=>e.jsxs("div",{className:"schedule-item",style:{borderLeftColor:w(s.channel.id)},children:[e.jsx("div",{className:"schedule-time",children:s.status==="live"?e.jsx("span",{className:"live-badge",children:"LIVE"}):S(v(s))}),e.jsxs("div",{className:"schedule-info",children:[e.jsx("span",{className:"channel-name",children:s.channel.name}),e.jsx("span",{className:"title",children:s.title})]}),e.jsx("div",{className:"schedule-actions",children:e.jsx("a",{href:`https://www.youtube.com/watch?v=${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"youtube-link",title:"YouTubeã§é–‹ã",children:"â–¶"})})]},s.id))]})}function L(){const{holodexApiKey:t,settings:l,setApiKey:n,updateSettings:a}=f(),[i,o]=j.useState(t),d=async()=>{await n(i),alert("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ")};return e.jsxs("div",{className:"settings",children:[e.jsx("h3",{children:"âš™ï¸ è¨­å®š"}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"Holodex API"}),e.jsxs("p",{className:"help-text",children:[e.jsx("a",{href:"https://holodex.net/login",target:"_blank",rel:"noopener noreferrer",children:"Holodex"}),"ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"password",value:i,onChange:h=>o(h.target.value),placeholder:"Holodex APIã‚­ãƒ¼"}),e.jsx("button",{onClick:d,children:"ä¿å­˜"})]})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº"}),e.jsx("p",{className:"help-text",children:".icsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Google Calendar / Outlook / Apple Calendarã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚"}),e.jsx("p",{className:"help-text",style:{fontSize:"11px",color:"#999"},children:"â€» ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”»é¢ã®ã€Œ.icsã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"é€šçŸ¥è¨­å®š"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l.notifyOnNewStream,onChange:h=>a({notifyOnNewStream:h.target.checked})}),"æ–°ã—ã„é…ä¿¡äºˆå®šã‚’é€šçŸ¥"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"æ›´æ–°é–“éš”ï¼ˆåˆ†ï¼‰"}),e.jsx("input",{type:"number",min:"15",max:"360",value:l.syncIntervalMinutes,onChange:h=>a({syncIntervalMinutes:Number(h.target.value)})})]})]})]})}function R(){const[t,l]=j.useState("schedule"),{initialize:n,refreshSchedules:a,error:i}=f();j.useEffect(()=>{n()},[n]);const o=()=>{a()};return e.jsxs("div",{className:"side-panel",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"ğŸ­ VTuber Schedule"}),e.jsx("button",{onClick:o,className:"refresh-btn",title:"æ›´æ–°",children:"ğŸ”„"})]}),i&&e.jsxs("div",{className:"error-banner",children:["âš ï¸ ",i]}),e.jsxs("nav",{className:"tab-nav",children:[e.jsx("button",{className:t==="schedule"?"active":"",onClick:()=>l("schedule"),children:"ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"}),e.jsx("button",{className:t==="vtubers"?"active":"",onClick:()=>l("vtubers"),children:"ğŸ­ VTuber"}),e.jsx("button",{className:t==="settings"?"active":"",onClick:()=>l("settings"),children:"âš™ï¸ è¨­å®š"})]}),e.jsxs("main",{className:"main-content",children:[t==="schedule"&&e.jsx(V,{}),t==="vtubers"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(k,{})]}),t==="settings"&&e.jsx(L,{})]}),e.jsx("footer",{className:"footer",children:e.jsx("span",{children:"VTuber Schedule Calendar v1.2.0"})})]})}T.createRoot(document.getElementById("root")).render(e.jsx(j.StrictMode,{children:e.jsx(R,{})}));
