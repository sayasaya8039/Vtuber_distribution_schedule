import{r as x,u as I,j as e,s as E,g as b,c as A}from"./assets/store.js";function D(a){const c=a.trim();if(c.startsWith("UC")&&c.length>=24)return c.split(/[^a-zA-Z0-9_-]/)[0];const t=c.match(/youtube\.com\/channel\/(UC[a-zA-Z0-9_-]+)/);return t?t[1]:null}function V(){const[a,c]=x.useState(""),[t,l]=x.useState([]),[d,s]=x.useState(!1),{holodexApiKey:h,addVTuber:m,vtubers:g}=I(),f=async()=>{var p,w,n,o;if(!a.trim()||!h)return;const i=D(a);s(!0);try{if(i){const u=await fetch(`https://holodex.net/api/v2/channels/${i}`,{headers:{"X-APIKEY":h}});if(u.ok){const r=await u.json(),N={id:r.id,name:r.english_name||r.name,channelId:r.id,org:(p=r.org)!=null&&p.toLowerCase().includes("hololive")?"hololive":(w=r.org)!=null&&w.toLowerCase().includes("nijisanji")?"nijisanji":"indie",color:(n=r.org)!=null&&n.toLowerCase().includes("hololive")?"#00bfff":(o=r.org)!=null&&o.toLowerCase().includes("nijisanji")?"#ff6b6b":"#a855f7",avatarUrl:r.photo};l([N])}else l([])}else{const u=await E(h,a);l(u)}}catch(u){console.error("Search failed:",u),l([])}finally{s(!1)}},T=async i=>{await m(i),l(t.filter(p=>p.channelId!==i.channelId))},j=i=>g.some(p=>p.channelId===i);return e.jsxs("div",{className:"vtuber-search",children:[e.jsxs("div",{className:"search-input",children:[e.jsx("input",{type:"text",value:a,onChange:i=>c(i.target.value),onKeyDown:i=>i.key==="Enter"&&f(),placeholder:"VTuberå or YouTube URLè²¼ã£ã¦ã­!",disabled:!h}),e.jsx("button",{onClick:f,disabled:d||!h,children:d?"æ¤œç´¢ä¸­...":"è¿½åŠ ã™ã‚‹"})]}),!h&&e.jsx("p",{className:"warning",children:"è¨­å®šã‹ã‚‰Holodex APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ã­"}),e.jsx("p",{className:"help-text-small",children:"VTuberåã§æ¤œç´¢ã€ã¾ãŸã¯YouTube URLã‚„ãƒãƒ£ãƒ³ãƒãƒ«ID(UCã§å§‹ã¾ã‚‹)ã‚’ç›´æ¥å…¥åŠ›"}),t.length>0&&e.jsx("div",{className:"search-results",children:t.map(i=>e.jsxs("div",{className:"search-result-item",children:[e.jsx("img",{src:i.avatarUrl||"/icons/icon48.png",alt:i.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:i.name}),e.jsx("span",{className:"org",style:{color:i.color},children:i.org||"indie"})]}),e.jsx("button",{onClick:()=>T(i),disabled:j(i.channelId),children:j(i.channelId)?"è¿½åŠ æ¸ˆã¿":"è¿½åŠ "})]},i.channelId))})]})}function L(){const{vtubers:a,removeVTuber:c,selectVTuber:t,selectedVTuberId:l}=I();if(a.length===0)return e.jsxs("div",{className:"vtuber-list empty",children:[e.jsx("p",{children:"ğŸ­ ã¾ã VTuberãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{children:"ä¸Šã®æ¤œç´¢ã‹ã‚‰æ¨ã—ã‚’è¿½åŠ ã—ã‚ˆã†ï¼"})]});const d=s=>{t(l===s?null:s)};return e.jsxs("div",{className:"vtuber-list",children:[e.jsxs("h3",{children:["ç™»éŒ²æ¸ˆã¿VTuber (",a.length,")"]}),e.jsx("p",{className:"help-text-small",children:"ğŸ’¡ ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãã®äººã ã‘è¡¨ç¤º"}),a.map(s=>e.jsxs("div",{className:`vtuber-item ${l===s.channelId?"selected":""}`,onDoubleClick:()=>d(s.channelId),style:{cursor:"pointer"},children:[e.jsx("img",{src:s.avatarUrl||"/icons/icon48.png",alt:s.name,className:"avatar"}),e.jsxs("div",{className:"info",children:[e.jsx("span",{className:"name",children:s.name}),e.jsx("span",{className:"org-badge",style:{backgroundColor:s.color},children:s.org||"indie"})]}),e.jsx("button",{className:"remove-btn",onClick:h=>{h.stopPropagation(),c(s.channelId)},title:"å‰Šé™¤",children:"âœ•"})]},s.channelId))]})}function R(a,c){const t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//VTuber Schedule Calendar//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];for(const l of a){const d=c.find(g=>g.channelId===l.channel.id),s=b(l),h=new Date(s.getTime()+7200*1e3),m=g=>g.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");t.push("BEGIN:VEVENT"),t.push(`UID:${l.id}@vtuber-schedule`),t.push(`DTSTART:${m(s)}`),t.push(`DTEND:${m(h)}`),t.push(`SUMMARY:${(d==null?void 0:d.name)||l.channel.name} - ${l.title}`),t.push(`DESCRIPTION:https://www.youtube.com/watch?v=${l.id}`),t.push(`URL:https://www.youtube.com/watch?v=${l.id}`),t.push("END:VEVENT")}return t.push("END:VCALENDAR"),t.join(`\r
`)}function U(){const{schedules:a,vtubers:c,loading:t,selectedVTuberId:l,selectVTuber:d}=I(),[s,h]=x.useState("all"),[m,g]=x.useState("all"),f=l?c.find(n=>n.channelId===l):null,j=[...a.filter(n=>{if(l&&n.channel.id!==l)return!1;const o=b(n),u=new Date,r=new Date(u.getFullYear(),u.getMonth(),u.getDate()),N=new Date(r.getTime()+1440*60*1e3),S=new Date(r.getTime()+10080*60*1e3);let y=!0;if(s==="today")y=o>=r&&o<N;else if(s==="tomorrow"){const v=new Date(N.getTime()+864e5);y=o>=N&&o<v}else s==="week"&&(y=o>=r&&o<S);let C=!0;if(!l&&m!=="all"){const v=c.find(k=>k.channelId===n.channel.id);C=(v==null?void 0:v.org)===m}return y&&C})].sort((n,o)=>b(n).getTime()-b(o).getTime()),i=()=>{const n=R(j,c),o=new Blob([n],{type:"text/calendar;charset=utf-8"}),u=URL.createObjectURL(o),r=document.createElement("a");r.href=u,r.download=`vtuber-schedule-${new Date().toISOString().split("T")[0]}.ics`,r.click(),URL.revokeObjectURL(u)},p=n=>n.toLocaleString("ja-JP",{month:"numeric",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),w=n=>{const o=c.find(u=>u.channelId===n);return(o==null?void 0:o.color)||"#666"};return t?e.jsx("div",{className:"schedule-list loading",children:"èª­ã¿è¾¼ã¿ä¸­..."}):a.length===0?e.jsxs("div",{className:"schedule-list empty",children:[e.jsx("p",{children:"é…ä¿¡äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“"}),c.length===0&&e.jsx("p",{children:"VTuberã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]}):e.jsxs("div",{className:"schedule-list",children:[e.jsx("div",{className:"filter-section",children:e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:s,onChange:n=>h(n.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨æœŸé–“"}),e.jsx("option",{value:"today",children:"ä»Šæ—¥"}),e.jsx("option",{value:"tomorrow",children:"æ˜æ—¥"}),e.jsx("option",{value:"week",children:"ä»Šé€±"})]}),e.jsxs("select",{value:m,onChange:n=>g(n.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"å…¨ã‚°ãƒ«ãƒ¼ãƒ—"}),e.jsx("option",{value:"hololive",children:"hololive"}),e.jsx("option",{value:"nijisanji",children:"ã«ã˜ã•ã‚“ã˜"}),e.jsx("option",{value:"indie",children:"ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼"})]})]})}),f&&e.jsxs("div",{className:"selected-vtuber-banner",children:[e.jsxs("span",{children:["ğŸ¯ ",f.name," ã®é…ä¿¡"]}),e.jsx("button",{onClick:()=>d(null),className:"clear-filter-btn",children:"âœ• è§£é™¤"})]}),e.jsxs("div",{className:"schedule-header",children:[e.jsxs("h3",{children:["é…ä¿¡äºˆå®š (",j.length,"ä»¶)"]}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"export-btn",onClick:i,title:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ",disabled:j.length===0,children:"ğŸ“… .ics"})})]}),j.length===0?e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"è©²å½“ã™ã‚‹é…ä¿¡ãŒã‚ã‚Šã¾ã›ã‚“"})}):j.map(n=>e.jsxs("div",{className:"schedule-item",style:{borderLeftColor:w(n.channel.id)},children:[e.jsx("div",{className:"schedule-time",children:n.status==="live"?e.jsx("span",{className:"live-badge",children:"LIVE"}):p(b(n))}),e.jsxs("div",{className:"schedule-info",children:[e.jsx("span",{className:"channel-name",children:n.channel.name}),e.jsx("span",{className:"title",children:n.title})]}),e.jsx("div",{className:"schedule-actions",children:e.jsx("a",{href:`https://www.youtube.com/watch?v=${n.id}`,target:"_blank",rel:"noopener noreferrer",className:"youtube-link",title:"YouTubeã§é–‹ã",children:"â–¶"})})]},n.id))]})}function O(){const{holodexApiKey:a,settings:c,setApiKey:t,updateSettings:l}=I(),[d,s]=x.useState(a),h=async()=>{await t(d),alert("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ")};return e.jsxs("div",{className:"settings",children:[e.jsx("h3",{children:"âš™ï¸ è¨­å®š"}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"Holodex API"}),e.jsxs("p",{className:"help-text",children:[e.jsx("a",{href:"https://holodex.net/login",target:"_blank",rel:"noopener noreferrer",children:"Holodex"}),"ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"password",value:d,onChange:m=>s(m.target.value),placeholder:"Holodex APIã‚­ãƒ¼"}),e.jsx("button",{onClick:h,children:"ä¿å­˜"})]})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº"}),e.jsx("p",{className:"help-text",children:".icsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Google Calendar / Outlook / Apple Calendarã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚"}),e.jsx("p",{className:"help-text",style:{fontSize:"11px",color:"#999"},children:"â€» ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”»é¢ã®ã€Œ.icsã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h4",{children:"é€šçŸ¥è¨­å®š"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:c.notifyOnNewStream,onChange:m=>l({notifyOnNewStream:m.target.checked})}),"æ–°ã—ã„é…ä¿¡äºˆå®šã‚’é€šçŸ¥"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"æ›´æ–°é–“éš”ï¼ˆåˆ†ï¼‰"}),e.jsx("input",{type:"number",min:"15",max:"360",value:c.syncIntervalMinutes,onChange:m=>l({syncIntervalMinutes:Number(m.target.value)})})]})]})]})}function P(){const[a,c]=x.useState("schedule"),{initialize:t,refreshSchedules:l,error:d,selectedVTuberId:s}=I();x.useEffect(()=>{t()},[t]),x.useEffect(()=>{s&&c("schedule")},[s]);const h=()=>{l()};return e.jsxs("div",{className:"side-panel",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"ğŸ­ VTuber Schedule"}),e.jsx("button",{onClick:h,className:"refresh-btn",title:"æ›´æ–°",children:"ğŸ”„"})]}),d&&e.jsxs("div",{className:"error-banner",children:["âš ï¸ ",d]}),e.jsxs("nav",{className:"tab-nav",children:[e.jsx("button",{className:a==="schedule"?"active":"",onClick:()=>c("schedule"),children:"ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"}),e.jsx("button",{className:a==="vtubers"?"active":"",onClick:()=>c("vtubers"),children:"ğŸ­ VTuber"}),e.jsx("button",{className:a==="settings"?"active":"",onClick:()=>c("settings"),children:"âš™ï¸ è¨­å®š"})]}),e.jsxs("main",{className:"main-content",children:[a==="schedule"&&e.jsx(U,{}),a==="vtubers"&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(L,{})]}),a==="settings"&&e.jsx(O,{})]}),e.jsx("footer",{className:"footer",children:e.jsx("span",{children:"VTuber Schedule Calendar v1.2.0"})})]})}A.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(P,{})}));
